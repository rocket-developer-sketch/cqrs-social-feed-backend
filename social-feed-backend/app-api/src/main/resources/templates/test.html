<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STOMP WebSocket Client</title>

    <!-- SockJS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <!-- STOMP.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
<h2>WebSocket STOMP Client</h2>

<!-- 입력 폼 -->
<label for="token">Authorization Token:</label>
<input type="text" id="token" placeholder="Enter your JWT token"><br><br>

<label for="destination">Subscription Channel:</label>
<input type="text" id="destination" placeholder="Enter subscription channel (e.g. /topic/notification/1)"><br><br>

<button onclick="connectWebSocket()">Connect and Subscribe</button>

<div id="status">Status: Disconnected</div>
<div id="messages"></div>

<script>
    let stompClient = null;

    function connectWebSocket() {
        const token = document.getElementById('token').value;
        const destination = document.getElementById('destination').value;

        if (!token || !destination) {
            alert("Please provide both the token and destination.");
            return;
        }

        const socket = new SockJS('/scf');
        stompClient = Stomp.over(socket);

        const headers = {
            Authorization: `Bearer ${token}`
        };

        stompClient.connect(headers, function(frame) {
            document.getElementById('status').innerText = 'Connected to WebSocket';

            stompClient.subscribe(destination, function(message) {
                console.log('Received message:', message.body);
                document.getElementById('messages').innerHTML += `<p>Received: ${message.body}</p>`;
            });

        }, function(error) {
            console.log("Error: " + error);
            document.getElementById('status').innerText = 'Connection Failed';
        });
    }

    // WebSocket 연결 실패 시 처리
    function onClose() {
        document.getElementById('status').innerText = 'Disconnected from WebSocket';
    }
</script>
</body>
</html>
